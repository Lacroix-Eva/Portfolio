---
import Layout from "../../layouts/Layout.astro";
---

<Layout
  nomPage="Contact"
  description="Contactez-moi pour discuter d'une opportunit√© de stage ou d'alternance dans les domaines du digital, du design ou de la communication."
>
  <main class="px-5 lg:px-20">
    <h2 class="mb-6 text-center">Envie de collaborer avec moi ?</h2>

    <p class="text-center mb-10 opacity-80 bg-base-100">
      Je suis √©tudiante en BUT MMI et je recherche une opportunit√© de
      <strong>stage</strong> pour d√©velopper mes comp√©tences en design, web et communication.
      N'h√©sitez pas √† me contacter
      <!-- via ce formulaire -->
      .
    </p>

    <!-- Bloc maintenance -->
    <div
      class="mx-auto md:max-w-3xl lg:max-w-4xl w-full p-6 lg:p-12 rounded-3xl shadow-2xl
         bg-white/5 backdrop-blur-xl border border-white/10 text-center"
    >
      <div class="mb-2 lg:mb-4">
        <span
          class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-accent/20 text-accent mb-2 lg:mb-3 text-4xl"
          aria-hidden="true"
        >
          üõ†Ô∏è
        </span>
      </div>

      <h3 class="mb-4">Formulaire temporairement indisponible</h3>
      <p class="text-white/70 mb-4">
        Je travaille actuellement √† am√©liorer le formulaire. <br />
        Merci de votre patience !
      </p>
    </div>

    <!-- <form
      id="contact-form"
      action="/api/contact"
      method="post"
      enctype="multipart/form-data"
      class="mx-auto max-w-3xl lg:max-w-4xl w-full space-y-10 p-8 md:p-12 rounded-3xl shadow-2xl
         bg-white/5 backdrop-blur-xl border border-white/10 transition-all"
    >
      <fieldset class="space-y-4">
        <legend class="text-xl font-semibold md:text-2xl lg:text-3xl mb-4">
          Type d'opportunit√©
        </legend>

        <div class="relative">
          <select
            name="type"
            required
            class="peer w-full h-14 bg-white/5 border border-white/10 rounded-xl px-3
             pr-12 appearance-none text-lg
             focus:border-primary focus:ring-2 focus:ring-primary/40 transition-all"
          >
            <option value="" disabled selected hidden></option>
            <option value="stage" class="text-black">Stage</option>
            <option value="alternance" class="text-black">Alternance</option>
            <option value="autre" class="text-black">Autre proposition</option>
          </select>

          <label
            class="absolute left-4 top-1 text-base text-white/70 pointer-events-none transition-all mt-1
             peer-focus:text-primary peer-focus:text-sm peer-focus:top-1.5
             peer-valid:opacity-0 peer-valid:translate-y-1 peer-valid:text-transparent"
          >
            S√©lection
          </label>

          <svg
            class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white/70
                   peer-focus:text-primary transition-colors"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M19 9l-7 7-7-7"></path>
          </svg>
        </div>

        <div id="autre-field" class="hidden mt-4">
          <div class="relative">
            <input
              type="text"
              name="autre_details"
              placeholder=" "
              class="auto-grow peer w-full min-h-14 bg-white/5 border border-white/10 rounded-xl px-4 pt-4
                focus:border-primary focus:ring-2 focus:ring-primary/40 transition-all"
            />
            <label
              class="absolute left-4 top-1 text-base text-white/70 pointer-events-none transition-all mt-1
              peer-focus:text-primary peer-focus:text-sm peer-focus:top-1.5
              peer-placeholder-shown:opacity-100 peer-placeholder-shown:translate-y-0
              peer-placeholder-shown:text-white/70
              peer-not-placeholder-shown:opacity-0 peer-not-placeholder-shown:translate-y-1 peer-not-placeholder-shown:text-transparent"
            >
              Pr√©cisez votre proposition
            </label>
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend class="text-xl font-semibold md:text-2xl lg:text-3xl mb-4">
          Vos informations
        </legend>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="relative">
            <textarea
              name="nom"
              required
              placeholder=" "
              class="auto-grow peer w-full min-h-14 bg-white/6 border border-white/10 rounded-xl px-4 pt-4
           focus:border-primary focus:ring-2 focus:ring-primary/40 transition-all
           resize-none overflow-hidden"
            ></textarea>

            <label
              class="absolute left-4 top-1 text-base text-white/70 pointer-events-none transition-all mt-1
           peer-focus:text-primary peer-focus:text-sm peer-focus:top-1.5
           peer-placeholder-shown:opacity-100 peer-placeholder-shown:translate-y-0
           peer-placeholder-shown:text-white/70
           peer-not-placeholder-shown:opacity-0 peer-not-placeholder-shown:translate-y-1
           peer-not-placeholder-shown:text-transparent"
            >
              Nom
            </label>
          </div>

          <div class="relative">
            <textarea
              name="entreprise"
              required
              placeholder=" "
              class="auto-grow peer w-full min-h-14 bg-white/6 border border-white/10 rounded-xl px-4 pt-4
           focus:border-primary focus:ring-2 focus:ring-primary/40 transition-all
           resize-none overflow-hidden"
            ></textarea>

            <label
              class="absolute left-4 top-1 text-base text-white/70 pointer-events-none transition-all mt-1
           peer-focus:text-primary peer-focus:text-sm peer-focus:top-1.5
           peer-placeholder-shown:opacity-100 peer-placeholder-shown:translate-y-0
           peer-placeholder-shown:text-white/70
           peer-not-placeholder-shown:opacity-0 peer-not-placeholder-shown:translate-y-1
           peer-not-placeholder-shown:text-transparent"
            >
              Entreprise (facultatif)
            </label>
          </div>

          <div class="relative">
            <textarea
              name="email"
              required
              placeholder=" "
              class="auto-grow peer w-full min-h-14 bg-white/6 border border-white/10 rounded-xl px-4 pt-4
           focus:border-primary focus:ring-2 focus:ring-primary/40 transition-all
           resize-none overflow-hidden"
            ></textarea>

            <label
              class="absolute left-4 top-1 text-base text-white/70 pointer-events-none transition-all mt-1
           peer-focus:text-primary peer-focus:text-sm peer-focus:top-1.5
           peer-placeholder-shown:opacity-100 peer-placeholder-shown:translate-y-0
           peer-placeholder-shown:text-white/70
           peer-not-placeholder-shown:opacity-0 peer-not-placeholder-shown:translate-y-1
           peer-not-placeholder-shown:text-transparent"
            >
              Email
            </label>
          </div>

          <div class="relative">
            <textarea
              name="telephone"
              required
              placeholder=" "
              class="auto-grow peer w-full min-h-14 bg-white/6 border border-white/10 rounded-xl px-4 pt-4
           focus:border-primary focus:ring-2 focus:ring-primary/40 transition-all
           resize-none overflow-hidden"
            ></textarea>

            <label
              class="absolute left-4 top-1 text-base text-white/70 pointer-events-none transition-all mt-1
           peer-focus:text-primary peer-focus:text-sm peer-focus:top-1.5
           peer-placeholder-shown:opacity-100 peer-placeholder-shown:translate-y-0
           peer-placeholder-shown:text-white/70
           peer-not-placeholder-shown:opacity-0 peer-not-placeholder-shown:translate-y-1
           peer-not-placeholder-shown:text-transparent"
            >
              T√©l√©phone (facultatif)
            </label>
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend class="text-xl font-semibold md:text-2xl lg:text-3xl mb-4">
          Message
        </legend>

        <div class="relative">
          <textarea
            name="message"
            required
            placeholder=" "
            class="auto-grow peer w-full bg-white/6 border border-white/10 rounded-xl px-4 pt-4
            focus:border-primary focus:ring-2 focus:ring-primary/40 transition-all
            resize-none overflow-hidden min-h-[8rem]"
          ></textarea>

          <label
            class="absolute left-4 top-1 text-base text-white/70 pointer-events-none transition-all mt-1
            peer-focus:text-primary peer-focus:text-sm peer-focus:top-1.5
            peer-placeholder-shown:opacity-100 peer-placeholder-shown:translate-y-0
            peer-placeholder-shown:text-white/70
            peer-not-placeholder-shown:opacity-0 peer-not-placeholder-shown:translate-y-1 peer-not-placeholder-shown:text-transparent"
          >
            Votre message
          </label>
        </div>
      </fieldset>

      <fieldset>
        <legend class="text-xl font-semibold md:text-2xl lg:text-3xl mb-4">
          Pi√®ces jointes
        </legend>

        <div class="flex flex-col sm:flex-row sm:items-center gap-3">
          <input
            id="fichiers-input"
            name="fichiers[]"
            type="file"
            multiple
            accept=".pdf,.png,.jpg,.jpeg,.doc,.docx"
            class="sr-only"
          />

          <label
            for="fichiers-input"
            class="btn btn-outline btn-accent w-full sm:w-auto text-center px-6 py-3 rounded-xl"
          >
            Choisir des fichiers
          </label>

          <div
            id="fichiers-list"
            class="w-full sm:flex-1 bg-white/6 border border-white/10 rounded-xl p-3 text-sm text-white/80 max-h-36 overflow-auto"
            aria-live="polite"
          >
            <p class="opacity-60 text-xs mb-0">Aucun fichier s√©lectionn√©</p>
          </div>
        </div>

        <p class="text-xs mt-2 text-white/60">
          Formats accept√©s: PDF, JPG, PNG, DOC. Taille max: 10MB par fichier.
        </p>

        <script>
          (function () {
            const input = document.getElementById("fichiers-input");
            const list = document.getElementById("fichiers-list");

            input.addEventListener("change", () => {
              list.innerHTML = "";
              if (!input.files || input.files.length === 0) {
                list.innerHTML =
                  '<p class="opacity-60 text-xs mb-0">Aucun fichier s√©lectionn√©</p>';
                return;
              }

              const ul = document.createElement("ul");
              ul.className = "space-y-1";

              Array.from(input.files).forEach((file) => {
                const li = document.createElement("li");
                li.className = "flex items-center justify-between gap-2";

                const name = document.createElement("span");
                name.className = "truncate";
                name.textContent = file.name;

                const size = document.createElement("span");
                size.className = "text-xs opacity-60";
                const kb = Math.round(file.size / 1024);
                size.textContent =
                  kb >= 1024 ? Math.round(kb / 1024) + " MB" : kb + " KB";

                li.appendChild(name);
                li.appendChild(size);
                ul.appendChild(li);
              });

              list.appendChild(ul);
            });
          })();
        </script>
      </fieldset>

      <div class="text-center">
        <button
          type="submit"
          class="btn btn-primary px-10 py-3 rounded-full text-lg shadow-lg hover:shadow-primary/30 transition-all"
        >
          Envoyer
        </button>
      </div>
    </form> -->

    <div class="mt-12 lg:mt-20">
      <h2 class="mb-3 lg:mb-6 text-center">Me contacter par mail</h2>
      <div class="space-y-4 text-center text-neutral text-base lg:text-xl">
        <a href="mailto:lacroixeva32@gmail.com" class="link">
          lacroixeva32@gmail.com
        </a>
      </div>
    </div>

    <div class="mt-12 lg:mt-20">
      <h2 class="mb-3 lg:mb-6 text-center">Besoin de mon CV ?</h2>
      <div class="text-center flex justify-center gap-4">
        <a
          href="/CV/CV_LACROIX_Eva.pdf"
          target="_blank"
          rel="noopener noreferrer"
          class="btn btn-outline btn-accent"
        >
          Visualiser le CV
        </a>

        <a
          href="/CV/CV_LACROIX_Eva.pdf"
          download="CV_LACROIX_Eva.pdf"
          class="btn btn-secondary"
        >
          T√©l√©charger le CV (PDF)
        </a>
      </div>
    </div>
  </main>
</Layout>

<!-- Script apparition champ "autre" + auto-grow -->
<script>
  const select = document.querySelector('select[name="type"]');
  const autreField = document.getElementById("autre-field");

  select.addEventListener("change", () => {
    autreField.classList.toggle("hidden", select.value !== "autre");
  });

  // Auto-grow pour tous les inputs text + textarea
  const growFields = document.querySelectorAll(".auto-grow");

  growFields.forEach((field) => {
    field.addEventListener("input", () => {
      field.style.height = "auto";
      field.style.height = field.scrollHeight + "px";
    });
  });

  const form = document.getElementById("contact-form");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const data = new FormData(form);
    const res = await fetch(form.action, {
      method: "POST",
      body: data,
    });
    const json = await res.json();
    alert(json.message);
  });
</script>
